<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="zh"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>VocabularyResource.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Docs Web</a> &gt; <a href="index.source.html" class="el_package">com.sismics.docs.rest.resource</a> &gt; <span class="el_source">VocabularyResource.java</span></div><h1>VocabularyResource.java</h1><pre class="source lang-java linenums">package com.sismics.docs.rest.resource;

import com.sismics.docs.core.dao.VocabularyDao;
import com.sismics.docs.core.model.jpa.Vocabulary;
import com.sismics.docs.rest.constant.BaseFunction;
import com.sismics.rest.exception.ForbiddenClientException;
import com.sismics.rest.util.ValidationUtil;

import javax.json.Json;
import javax.json.JsonArrayBuilder;
import javax.json.JsonObjectBuilder;
import javax.ws.rs.*;
import javax.ws.rs.core.Response;
import java.util.List;

/**
 * Vocabulary REST resources.
 * 
 * @author bgamard
 */
@Path(&quot;/vocabulary&quot;)
<span class="nc" id="L22">public class VocabularyResource extends BaseResource {</span>
    /**
     * Get a vocabulary.
     *
     * @api {get} /vocabulary/:name Get a vocabulary
     * @apiName GetVocabularyName
     * @apiGroup Vocabulary
     * @apiParam {String} name Vocabulary name
     * @apiSuccess {Object[]} entries List of vocabulary entries
     * @apiSuccess {String} entries.id ID
     * @apiSuccess {String} entries.name Name
     * @apiSuccess {String} entries.value Value
     * @apiSuccess {Number} entries.order Order
     * @apiError (client) ForbiddenError Access denied
     * @apiPermission user
     * @apiVersion 1.5.0
     *
     * @param name Name
     * @return Response
     */
    @GET
    @Path(&quot;{name: [a-z0-9\\-]+}&quot;)
    public Response get(@PathParam(&quot;name&quot;) String name) {
<span class="nc bnc" id="L45" title="All 2 branches missed.">        if (!authenticate()) {</span>
<span class="nc" id="L46">            throw new ForbiddenClientException();</span>
        }
        
        // Assemble results
<span class="nc" id="L50">        VocabularyDao vocabularyDao = new VocabularyDao();</span>
<span class="nc" id="L51">        List&lt;Vocabulary&gt; vocabularyList = vocabularyDao.getByName(name);</span>
<span class="nc" id="L52">        JsonArrayBuilder entries = Json.createArrayBuilder();</span>
<span class="nc bnc" id="L53" title="All 2 branches missed.">        for (Vocabulary vocabulary : vocabularyList) {</span>
<span class="nc" id="L54">            entries.add(Json.createObjectBuilder()</span>
<span class="nc" id="L55">                    .add(&quot;id&quot;, vocabulary.getId())</span>
<span class="nc" id="L56">                    .add(&quot;name&quot;, vocabulary.getName())</span>
<span class="nc" id="L57">                    .add(&quot;value&quot;, vocabulary.getValue())</span>
<span class="nc" id="L58">                    .add(&quot;order&quot;, vocabulary.getOrder()));</span>
<span class="nc" id="L59">        }</span>
        
        // Always return OK
<span class="nc" id="L62">        JsonObjectBuilder response = Json.createObjectBuilder()</span>
<span class="nc" id="L63">                .add(&quot;entries&quot;, entries);</span>
<span class="nc" id="L64">        return Response.ok().entity(response.build()).build();</span>
    }
    
    /**
     * Add a vocabulary entry.
     *
     * @api {put} /vocabulary Add a vocabulary entry
     * @apiName PutVocabulary
     * @apiGroup Vocabulary
     * @apiParam {String{1..50}} name Vocabulary name
     * @apiParam {String{1..500}} value Entry value
     * @apiParam {Number} order Entry order
     * @apiSuccess {String} id ID
     * @apiSuccess {String} name Name
     * @apiSuccess {String} value Value
     * @apiSuccess {Number} order Order
     * @apiError (client) ForbiddenError Access denied
     * @apiError (client) ValidationError Validation error
     * @apiPermission admin
     * @apiVersion 1.5.0
     *
     * @param name Name
     * @param value Value
     * @param orderStr Order
     * @return Response
     */
    @PUT
    public Response add(@FormParam(&quot;name&quot;) String name,
            @FormParam(&quot;value&quot;) String value,
            @FormParam(&quot;order&quot;) String orderStr) {
<span class="nc bnc" id="L94" title="All 2 branches missed.">        if (!authenticate()) {</span>
<span class="nc" id="L95">            throw new ForbiddenClientException();</span>
        }
<span class="nc" id="L97">        checkBaseFunction(BaseFunction.ADMIN);</span>
        
        // Validate input data
<span class="nc" id="L100">        name = ValidationUtil.validateLength(name, &quot;name&quot;, 1, 50, false);</span>
<span class="nc" id="L101">        ValidationUtil.validateRegex(name, &quot;name&quot;, &quot;[a-z0-9\\-]+&quot;);</span>
<span class="nc" id="L102">        value = ValidationUtil.validateLength(value, &quot;value&quot;, 1, 500, false);</span>
<span class="nc" id="L103">        Integer order = ValidationUtil.validateInteger(orderStr, &quot;order&quot;);</span>
        
        // Create the vocabulary
<span class="nc" id="L106">        VocabularyDao vocabularyDao = new VocabularyDao();</span>
<span class="nc" id="L107">        Vocabulary vocabulary = new Vocabulary();</span>
<span class="nc" id="L108">        vocabulary.setName(name);</span>
<span class="nc" id="L109">        vocabulary.setValue(value);</span>
<span class="nc" id="L110">        vocabulary.setOrder(order);</span>
<span class="nc" id="L111">        vocabularyDao.create(vocabulary);</span>
        
        // Returns the vocabulary
<span class="nc" id="L114">        JsonObjectBuilder response = Json.createObjectBuilder()</span>
<span class="nc" id="L115">                .add(&quot;id&quot;, vocabulary.getId())</span>
<span class="nc" id="L116">                .add(&quot;name&quot;, vocabulary.getName())</span>
<span class="nc" id="L117">                .add(&quot;value&quot;, vocabulary.getValue())</span>
<span class="nc" id="L118">                .add(&quot;order&quot;, vocabulary.getOrder());</span>
<span class="nc" id="L119">        return Response.ok().entity(response.build()).build();</span>
    }
    
    /**
     * Update a vocabulary entry.
     *
     * @api {post} /vocabulary/:id Update a vocabulary entry
     * @apiName PostVocabularyId
     * @apiGroup Vocabulary
     * @apiParam {String} id Entry ID
     * @apiParam {String{1..50}} name Vocabulary name
     * @apiParam {String{1..500}} value Entry value
     * @apiParam {Number} order Entry order
     * @apiSuccess {String} id ID
     * @apiSuccess {String} name Name
     * @apiSuccess {String} value Value
     * @apiSuccess {Number} order Order
     * @apiError (client) ForbiddenError Access denied
     * @apiError (client) ValidationError Validation error
     * @apiError (client) NotFound Vocabulary not found
     * @apiPermission admin
     * @apiVersion 1.5.0
     *
     * @param id ID
     * @param name Name
     * @param value Value
     * @param orderStr Order
     * @return Response
     */
    @POST
    @Path(&quot;{id: [a-z0-9\\-]+}&quot;)
    public Response update(@PathParam(&quot;id&quot;) String id,
            @FormParam(&quot;name&quot;) String name,
            @FormParam(&quot;value&quot;) String value,
            @FormParam(&quot;order&quot;) String orderStr) {
<span class="nc bnc" id="L154" title="All 2 branches missed.">        if (!authenticate()) {</span>
<span class="nc" id="L155">            throw new ForbiddenClientException();</span>
        }
<span class="nc" id="L157">        checkBaseFunction(BaseFunction.ADMIN);</span>
        
        // Validate input data
<span class="nc" id="L160">        name = ValidationUtil.validateLength(name, &quot;name&quot;, 1, 50, true);</span>
<span class="nc bnc" id="L161" title="All 2 branches missed.">        if (name != null) {</span>
<span class="nc" id="L162">            ValidationUtil.validateRegex(name, &quot;name&quot;, &quot;[a-z0-9\\-]+&quot;);</span>
        }
<span class="nc" id="L164">        value = ValidationUtil.validateLength(value, &quot;value&quot;, 1, 500, true);</span>
<span class="nc" id="L165">        Integer order = null;</span>
<span class="nc bnc" id="L166" title="All 2 branches missed.">        if (orderStr != null) {</span>
<span class="nc" id="L167">            order = ValidationUtil.validateInteger(orderStr, &quot;order&quot;);</span>
        }
        
        // Get the vocabulary entry
<span class="nc" id="L171">        VocabularyDao vocabularyDao = new VocabularyDao();</span>
<span class="nc" id="L172">        Vocabulary vocabulary = vocabularyDao.getById(id);</span>
<span class="nc bnc" id="L173" title="All 2 branches missed.">        if (vocabulary == null) {</span>
<span class="nc" id="L174">            throw new NotFoundException();</span>
        }
        
        // Update the vocabulary
<span class="nc bnc" id="L178" title="All 2 branches missed.">        if (name != null) {</span>
<span class="nc" id="L179">            vocabulary.setName(name);</span>
        }
<span class="nc bnc" id="L181" title="All 2 branches missed.">        if (value != null) {</span>
<span class="nc" id="L182">            vocabulary.setValue(value);</span>
        }
<span class="nc bnc" id="L184" title="All 2 branches missed.">        if (order != null) {</span>
<span class="nc" id="L185">            vocabulary.setOrder(order);</span>
        }
<span class="nc" id="L187">        vocabularyDao.update(vocabulary);</span>
        
        // Returns the vocabulary
<span class="nc" id="L190">        JsonObjectBuilder response = Json.createObjectBuilder()</span>
<span class="nc" id="L191">                .add(&quot;id&quot;, vocabulary.getId())</span>
<span class="nc" id="L192">                .add(&quot;name&quot;, vocabulary.getName())</span>
<span class="nc" id="L193">                .add(&quot;value&quot;, vocabulary.getValue())</span>
<span class="nc" id="L194">                .add(&quot;order&quot;, vocabulary.getOrder());</span>
<span class="nc" id="L195">        return Response.ok().entity(response.build()).build();</span>
    }
    
    /**
     * Delete a vocabulary entry.
     *
     * @api {delete} /vocabulary/:id Delete a vocabulary entry
     * @apiName DeleteVocabularyId
     * @apiGroup Vocabulary
     * @apiParam {String} id Entry ID
     * @apiSuccess {String} status Status OK
     * @apiError (client) ForbiddenError Access denied
     * @apiError (client) NotFound Vocabulary not found
     * @apiPermission admin
     * @apiVersion 1.5.0
     *
     * @param id ID
     * @return Response
     */
    @DELETE
    @Path(&quot;{id: [a-z0-9\\-]+}&quot;)
    public Response delete(@PathParam(&quot;id&quot;) String id) {
<span class="nc bnc" id="L217" title="All 2 branches missed.">        if (!authenticate()) {</span>
<span class="nc" id="L218">            throw new ForbiddenClientException();</span>
        }
<span class="nc" id="L220">        checkBaseFunction(BaseFunction.ADMIN);</span>
        
        // Get the vocabulary
<span class="nc" id="L223">        VocabularyDao vocabularyDao = new VocabularyDao();</span>
<span class="nc" id="L224">        Vocabulary vocabulary = vocabularyDao.getById(id);</span>
<span class="nc bnc" id="L225" title="All 2 branches missed.">        if (vocabulary == null) {</span>
<span class="nc" id="L226">            throw new NotFoundException();</span>
        }
        
        // Delete the vocabulary
<span class="nc" id="L230">        vocabularyDao.delete(id);</span>
        
        // Always return OK
<span class="nc" id="L233">        JsonObjectBuilder response = Json.createObjectBuilder()</span>
<span class="nc" id="L234">                .add(&quot;status&quot;, &quot;ok&quot;);</span>
<span class="nc" id="L235">        return Response.ok().entity(response.build()).build();</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.9.202303310957</span></div></body></html>